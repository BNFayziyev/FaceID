from flask import Flask, request
import requests

app = Flask(__name__)

# Telegram sozlamalari
BOT_TOKEN = 'SIZNING_BOT_TOKENINGIZ'
CHAT_ID = 'XABAR_BORISHI_KERAK_BOLGAN_ID'

@app.route('/hik-webhook', methods=['POST'])
def hik_listener():
    # Terminaldan kelgan XML ma'lumotni olish
    data = request.data.decode('utf-8')
    
    # Ma'lumot ichidan ism va vaqtni qidirish (Sodda usulda)
    # Aslida lxml yoki xml.etree dan foydalanish yaxshiroq
    if "employeeNo" in data:
        # Bu yerda ma'lumotni tahlil qilib, kerakli qismlarni ajratamiz
        text_message = f"ðŸ”” Terminaldan xabar:\n{data[:200]}..." # Namuna uchun
        
        # Telegram'ga yuborish
        requests.post(f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage", 
                      json={"chat_id": CHAT_ID, "text": "Kimdir terminaldan o'tdi!"})
        
    return "OK", 200

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)